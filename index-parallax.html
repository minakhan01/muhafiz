<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>

	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta name="author" content="SemiColonWeb" />

	<!-- Stylesheets
	============================================= -->
	<link href="http://fonts.googleapis.com/css?family=Lato:300,400,400italic,600,700|Raleway:300,400,500,600,700|Crete+Round:400italic" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" href="css/bootstrap.css" type="text/css" />
	<link rel="stylesheet" href="style.css" type="text/css" />
	<link rel="stylesheet" href="css/dark.css" type="text/css" />
	<link rel="stylesheet" href="css/font-icons.css" type="text/css" />
	<link rel="stylesheet" href="css/animate.css" type="text/css" />
	<link rel="stylesheet" href="css/magnific-popup.css" type="text/css" />

	<link rel="stylesheet" href="css/responsive.css" type="text/css" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<!--[if lt IE 9]>
		<script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
	<![endif]-->

	<!-- External JavaScripts
	============================================= -->
	<script type="text/javascript" src="js/jquery.js"></script>
	<script type="text/javascript" src="js/plugins.js"></script>
	<script src="https://cdn.firebase.com/js/client/2.3.1/firebase.js"></script>

<!-- <script src="http://code.jquery.com/jquery-1.9.1.js"></script> -->
  <script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>
  <script>
  $(function() {
    $( "#datepicker" ).datepicker().show();
  });
  </script>
 
	<!-- Document Title
	============================================= -->
	<title>Muhafiz</title>
	<style>

      #map {
        height: 500px;
      }
      #map1 {
        height: 400px;
      }
      .controls {
  margin-top: 10px;
  border: 1px solid transparent;
  border-radius: 2px 0 0 2px;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  height: 32px;
  outline: none;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
}


.div-inline{
    display:inline-block;
}


#pac-input {
  background-color: #fff;
  font-family: Roboto;
  font-size: 15px;
  font-weight: 300;
  margin-left: 12px;
  padding: 0 11px 0 13px;
  text-overflow: ellipsis;
  width: 300px;
}

#pac-input:focus {
  border-color: #4d90fe;
}

#pac-input1 {
/*  background-color: #fff;
  font-family: Roboto;
  font-size: 15px;
  font-weight: 300;
  margin-left: 12px;
  padding: 0 11px 0 13px;
  text-overflow: ellipsis;
  width: 300px;*/
}


#pac-input1:focus {
  border-color: #4d90fe;
}

.pac-input2 {
  background-color: #fff;
  font-family: Roboto;
  font-size: 15px;
  font-weight: 300;
  margin-left: 12px;
  padding: 0 11px 0 13px;
  text-overflow: ellipsis;
  display:inline-block;
}
    </style>

</head>

<body class="stretched">

	<!-- Document Wrapper
	============================================= -->
	<div id="wrapper" class="clearfix">

		<section id="slider" class="slider-parallax with-header">

			<div class="full-screen" style="background: url('9.jpg') center center no-repeat; background-size: cover;">

			</div>

		</section>

		<!-- Header
		============================================= -->
		<header id="header" class="transparent-header">

			<div id="header-wrap">

				<div class="container clearfix">

					<div id="primary-menu-trigger"><i class="icon-reorder"></i></div>

					<!-- Logo
					============================================= -->
					<div id="logo">
						<a href="index.html" class="standard-logo" data-dark-logo="images/logo-dark.png"><img src="images/logo.png" alt="Canvas Logo"></a>
						<a href="index.html" class="retina-logo" data-dark-logo="images/logo-dark@2x.png"><img src="images/logo.png" alt="Canvas Logo"></a>
					</div><!-- #logo end -->

					<!-- Primary Navigation
					============================================= -->
					<nav id="primary-menu">

						<ul>
							<li class="current"><a href="index.html"><div>Home</div></a>
							</li>
							<li><a href="#mapsection"><div>Map</div></a>
							<li><a href="#content"><div>About Us</div></a>
							<li><a href="#inputsection"><div>Report Crime</div></a>

						</ul>
					</nav><!-- #primary-menu end -->

				</div>

			</div>

		</header><!-- #header end -->

		<div class="clear"></div>
		<section id="mapsection">
				<div class="section">
					    <input id="pac-input" class="controls" type="text" placeholder="Enter a location">

    					<div id="map"></div>
				</div>
		</section>
		<section id="content">
		<!-- Content
		============================================= -->
		<section id="content">

			<div class="content-wrap nopadding">

				<div class="col-md-12 nopadding common-height">

					<div class="col-md-4 col-padding ohidden" style="background-color: #90C695;">
						<div>
							<h3 class="uppercase" style="font-weight: 600;">What is Muhafiz</h3>
							<p style="line-height: 1.8;"> Muhafiz is a crowdsourced crime collection website for Pakistan. Crime is not just underreported, but also poorly documented in Pakistan. Crouwdsourcing crime reporting allows us to get better crime statistics. </p>
							<i class="icon-bulb bgicon"></i>
						</div>
					</div>

					<div class="col-md-4 col-padding ohidden" style="background-color: #ffffff;">
						<div>
							<h3 class="uppercase" style="font-weight: 600;">What you can do</h3>
							<p style="line-height: 1.8;"> If you or someone you know has been the victim of a crime, please enter the date, crime and location in the form on our website. It's anonymous. Help us, help you :) </p>
							<a href="#" class="button button-border button-rounded button-light button-large">See Form</a>
							<i class="icon-cog bgicon"></i>
						</div>
					</div>
					<div class="col-md-4 col-padding ohidden" style="background-color: #FDE3A7;">
						<div>
							<h3 class="uppercase" style="font-weight: 600;">Why should you contribute</h3>
							<p style="line-height: 1.8;">Help us break the silence on crimes, and inform each other. Better crime statistics will not just keep the public informed and secure, but also help government authorites in tracking crime.</p>
							<i class="icon-cog bgicon"></i>
						</div>
					</div>

					<div class="clear"></div>

				</div>

				<div class="clear"></div>
			</div>

		</section><!-- #content end -->
		<section id="inputsection">
				<div class="section">
					    Date: <input type="text" class="pac-input2" id="datepicker">
					    <select id="crimename" name='test'>
						<option value='default' selected='selected'>Type of Crime</option>
						<option value='Murder'>Murder</option>
						<option value='Rape'>Rape</option>
						<option value='Theft'>Theft</option>
						</select>
						<input id="pac-input1" class="pac-input2" type="text" placeholder="Enter a location">
						<input id="latField" class="pac-input2" type="text" placeholder="Lat">
						<input id="lngField" class="pac-input2" type="text" placeholder="Lng">
<!-- 					    <div class="dropdown pac-input2">
				        <button class="btn btn-primary dropdown-toggle dropdown" type="button" data-toggle="dropdown">Type of crime
				        <span class="caret"></span></button>
				        <ul class="dropdown-menu">
				        <li><a href="#">Murder</a></li>
				        <li><a href="#">Rape</a></li>
				        <li><a href="#">Theft</a></li>
				        <li><a href="#">Robbery</a></li>
				        </ul>
				    	</div> -->
				    	<button class="btn btn-primary" id="submitButton">Submit</button>
				    	<div id="map1"></div>
				</div>
		</section>

	</div><!-- #wrapper end -->

	<!-- Go To Top
	============================================= -->
	<div id="gotoTop" class="icon-angle-up"></div>

<script>

var map, map1, heatmap, infowindow;
var location_list = [];

function addHeatMap() {
    heatmap = new google.maps.visualization.HeatmapLayer({
    data: location_list,
    map: map
  });
}

function initMap() {
  console.log("making map: "+location_list);
  map = new google.maps.Map(document.getElementById('map'), {
    zoom: 6,
    center: {lat: 33.6387439, lng: 73.0479067},
    scrollwheel: false,
    mapTypeId: google.maps.MapTypeId.ROADMAP
  });

  map1 = new google.maps.Map(document.getElementById('map1'), {
    zoom: 6,
    center: {lat: 33.6387439, lng: 73.0479067},
    scrollwheel: false,
    mapTypeId: google.maps.MapTypeId.ROADMAP
  });

  heatmap = new google.maps.visualization.HeatmapLayer({
    data: location_list,
    map: map
  });

  var input = /** @type {!HTMLInputElement} */(
      document.getElementById('pac-input'));
  var input1 = /** @type {!HTMLInputElement} */(
      document.getElementById('pac-input1'));
  var latInput = /** @type {!HTMLInputElement} */(
      document.getElementById('latField'));
  var lngInput = /** @type {!HTMLInputElement} */(
      document.getElementById('lngField'));

  map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);
  // map1.controls[google.maps.ControlPosition.TOP_LEFT].push(input1);

  var autocomplete = new google.maps.places.Autocomplete(input);
  var autocomplete1 = new google.maps.places.Autocomplete(input1);
  autocomplete.bindTo('bounds', map);
  autocomplete1.bindTo('bounds', map1);

  var infowindow = new google.maps.InfoWindow();
  var infowindow1 = new google.maps.InfoWindow();

  var marker = new google.maps.Marker({
    map: map,
    anchorPoint: new google.maps.Point(0, -29)
  });

  var marker1 = new google.maps.Marker({
    map: map1,
    anchorPoint: new google.maps.Point(0, -29)
  });

  autocomplete.addListener('place_changed', function() {
    infowindow.close();
    marker.setVisible(false);
    var place = autocomplete.getPlace();
    if (!place.geometry) {
      window.alert("Autocomplete's returned place contains no geometry");
      return;
    }

    // If the place has a geometry, then present it on a map.
    if (place.geometry.viewport) {
      map.fitBounds(place.geometry.viewport);
    } else {
      map.setCenter(place.geometry.location);
      map.setZoom(17);  // Why 17? Because it looks good.
    }
    marker.setIcon(/** @type {google.maps.Icon} */({
      url: place.icon,
      size: new google.maps.Size(71, 71),
      origin: new google.maps.Point(0, 0),
      anchor: new google.maps.Point(17, 34),
      scaledSize: new google.maps.Size(35, 35)
    }));

    marker.setPosition(place.geometry.location);
    marker.setVisible(true);

    var address = '';
    if (place.address_components) {
      address = [
        (place.address_components[0] && place.address_components[0].short_name || ''),
        (place.address_components[1] && place.address_components[1].short_name || ''),
        (place.address_components[2] && place.address_components[2].short_name || '')
      ].join(' ');
    }

    infowindow.setContent('<div><strong>' + place.name + '</strong><br>' + address);
    infowindow.open(map, marker);
  });

  autocomplete1.addListener('place_changed', function() {
    infowindow1.close();
    marker1.setVisible(false);
    var place = autocomplete1.getPlace();
    if (!place.geometry) {
      window.alert("Autocomplete's returned place contains no geometry");
      return;
    }

    // If the place has a geometry, then present it on a map.
    if (place.geometry.viewport) {
      map1.fitBounds(place.geometry.viewport);
    } else {
      map1.setCenter(place.geometry.location);
      map1.setZoom(17);  // Why 17? Because it looks good.
    }
    marker1.setIcon(/** @type {google.maps.Icon} */({
      url: place.icon,
      size: new google.maps.Size(71, 71),
      origin: new google.maps.Point(0, 0),
      anchor: new google.maps.Point(17, 34),
      scaledSize: new google.maps.Size(35, 35)
    }));
    marker1.setPosition(place.geometry.location);
    marker1.setVisible(true);
    lat = place.geometry.location.lat();
    lng = place.geometry.location.lng();
    latInput.value =  lat;
    lngInput.value = lng;

    var address = '';
    if (place.address_components) {
      address = [
        (place.address_components[0] && place.address_components[0].short_name || ''),
        (place.address_components[1] && place.address_components[1].short_name || ''),
        (place.address_components[2] && place.address_components[2].short_name || '')
      ].join(' ');
    }

    infowindow1.setContent('<div><strong>' + place.name + '</strong><br>' + address);
    infowindow1.open(map, marker);
  });
}

    var crime = "";
    var myFirebaseRef = new Firebase("https://safe-spot.firebaseio.com/");

    
    $("#submitButton").click(function(){
    console.log("submitButton");

    var crime = $('#crimename').find(":selected").text();
    var latitude = $('#latField').val();
    var longitude = $('#lngField').val();
    var address = $('#pac-input1').val();
    var date = $('#datepicker').val();

    console.log("crime: "+crime);
    console.log("latitude: "+latitude);
    console.log("longitude: "+longitude);
    console.log("date: "+date);
    console.log("address: "+address);

    // Generate a reference to a new location and add some data using push()
    var newPostRef = myFirebaseRef.push();
    newPostRef.set({time: Firebase.ServerValue.TIMESTAMP , 
        lon: longitude,
        lat: latitude,
        address: address,
        date: date,
        crime: crime});
    // Get the unique ID generated by push()
    var postID = newPostRef.key();
    console.log(date);
    });

    $(".dropdown-menu li a").click(function(){
    $(this).parents(".dropdown").find('.btn').html($(this).text() + ' <span class="caret"></span>');
    crime = $(this).text();
    });

function readValue(){
    // Get a database reference to our posts
    var ref = new Firebase("https://safe-spot.firebaseio.com/");

    ref.once("value", function(snapshot) {
          // The callback function will get called twice, once for "fred" and once for "barney"
          snapshot.forEach(function(childSnapshot) {
            // key will be "fred" the first time and "barney" the second time
            var key = childSnapshot.key();

            // childData will be the actual contents of the child
            var childData = childSnapshot.val();
            console.log(childData);
            lat = childData.lat;
            lon = childData.lon;
            addLatLong(lat, lon);
            // console.log("lat: "+lat);
            // console.log("lon: "+lon);
        });
        initMap();
    });
}

function addLatLong(latitude, longitude){
  location_new = new google.maps.LatLng(latitude, longitude);
  console.log("location_new: "+location_new);
    location_list.push(location_new);
}

function changeGradient() {
  var gradient = [
    'rgba(0, 255, 255, 0)',
    'rgba(0, 255, 255, 1)',
    'rgba(0, 191, 255, 1)',
    'rgba(0, 127, 255, 1)',
    'rgba(0, 63, 255, 1)',
    'rgba(0, 0, 255, 1)',
    'rgba(0, 0, 223, 1)',
    'rgba(0, 0, 191, 1)',
    'rgba(0, 0, 159, 1)',
    'rgba(0, 0, 127, 1)',
    'rgba(63, 0, 91, 1)',
    'rgba(127, 0, 63, 1)',
    'rgba(191, 0, 31, 1)',
    'rgba(255, 0, 0, 1)'
  ]
  heatmap.set('gradient', heatmap.get('gradient') ? null : gradient);
}

// Heatmap data: 500 Points
function getPoints() {
  return location_list;
}

    </script>
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAx0nk-kqKOI0rvEmHVdWcB8oj2f5_5HXA&signed_in=true&libraries=visualization,places&callback=readValue">
    </script>

    <script>

    // </script>
	<!-- Footer Scripts
	============================================= -->
	<script type="text/javascript" src="js/functions.js"></script>

</body>
</html>